#!/usr/bin/env python3
import time
import sys
import os
import shutil
import random

# --- 隠岐汽船フェリー「しらしま」デザイン (精緻・重厚版) ---

FERRY_SHIRASHIMA = [
    r"                                     ____________________        ",
    r"               _____________________|                    |____   ",
    r"           ___|                                               |  ",
    r"       _.-'    OKI KISEN    - SHIRASHIMA -                    |  ",
    r"    .-'                                                       |  ",
    r"   |   [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]    |  ",
    r"   |__________________________________________________________|  ",
    r"   \                                                         /   ",
    r"    `-------------------------------------------------------'    "
]

SMOKE_PATTERNS = [
    r"   (  )  ",
    r"  (    ) ",
    r" (      )",
    r"(        )"
]

def clear_screen():
    print("\033[2J\033[H", end="")

def get_terminal_size():
    try:
        columns, rows = shutil.get_terminal_size()
    except:
        columns, rows = 80, 24
    return columns, rows

def animate():
    cols, rows = get_terminal_size()
    f_width = len(FERRY_SHIRASHIMA[0])
    f_height = len(FERRY_SHIRASHIMA)
    
    smoke_list = []
    
    # 以前の安定したロジックへ復元
    for x in range(cols + 20, -f_width - 20, -1):
        clear_screen()
        
        # 煙の生成（安定した間隔）
        if x % 6 == 0:
            smoke_list.append([x + 38, rows // 2 - 7, 0])
        new_smoke = []
        for s in smoke_list:
            sx, sy, sf = s
            if sf < len(SMOKE_PATTERNS) and 0 < sx < cols:
                print(f"\033[{sy};{sx}H\033[37m{SMOKE_PATTERNS[sf]}\033[0m")
                new_smoke.append([sx + 1, sy - 1, sf + 1])
        smoke_list = new_smoke

        # 波の固定表示（ベースをブレさせない）
        y_wave = rows // 2 + 5
        print(f"\033[{y_wave};1H\033[34m" + "~" * cols + "\033[0m")
        wave_dyn = "  _.-'  " * (cols // 8 + 1)
        print(f"\033[{y_wave + 1};1H\033[36m" + wave_dyn[x % 8 : x % 8 + cols] + "\033[0m")

        # 船体の表示（重厚感のある低重心デザイン）
        y_ship = rows // 2 - f_height // 2
        bob = 1 if (x // 6) % 4 < 2 else 0
        
        for i, line in enumerate(FERRY_SHIRASHIMA):
            y_pos = y_ship + i + bob
            if 0 < y_pos < rows:
                if 0 <= x < cols - f_width:
                    # 彩色（ネイビーとホワイトを基調に）
                    colored = line.replace("OKI KISEN", "\033[1;34mOKI KISEN\033[0m")
                    colored = colored.replace("SHIRASHIMA", "\033[1;37mSHIRASHIMA\033[0m")
                    colored = colored.replace("[ ]", "\033[34m[ ]\033[0m")
                    print(f"\033[{y_pos};{x}H{colored}", end="")
                elif x < 0:
                    print(f"\033[{y_pos};1H{line[abs(x):]}", end="")
                else:
                    print(f"\033[{y_pos};{x}H{line[:cols-x]}", end="")

        if x == cols // 2:
            msg = "*** Welcome to OKI Islands ***"
            print(f"\033[{rows // 2 - 8};{cols // 2 - len(msg)//2}H\033[1;37m{msg}\033[0m")

        sys.stdout.flush()
        time.sleep(0.04)

if __name__ == "__main__":
    print("\033[?25l", end="") 
    try:
        animate()
    except KeyboardInterrupt:
        pass
    finally:
        print("\033[?25h", end="") 
        clear_screen()
