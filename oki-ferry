#!/usr/bin/env python3
import time
import sys
import os
import shutil
import random

# --- éš å²æ±½èˆ¹ãƒ•ã‚§ãƒªãƒ¼ã€Œã—ã‚‰ã—ã¾ã€& éš å²ã®æƒ…æ™¯ ---

# ç²¾å¯†ãªãƒ•ã‚§ãƒªãƒ¼ã—ã‚‰ã—ã¾ï¼ˆãƒ‡ãƒ¢ç”»åƒã‚’åŸºã«ã—ãŸç©¶æ¥µç‰ˆï¼‰
FERRY_SHIRASHIMA = [
    r"                   . _ _ _ _ _ _ _ _ _ _ _ _ .            ",
    r"               . -'                           '- .        ",
    r"           . -'        ____________________       '- .    ",
    r"       . -'           |   |   |   |   |   |            '- .",
    r"   . -'      _________|___|___|___|___|___|_________      '- .",
    r"  /        /                                         \        \ ",
    r" |        |      INDI LOVE (iO)        / \            |        |",
    r" |________|___________________________| O |___________|________|",
    r" |                                                            |",
    r" |   éš  å² æ±½ èˆ¹ ã— ã‚‰ ã— ã¾   (v) (o) (v) (o)                |",
    r" |                                                            |",
    r"  \__________________________________________________________/ ",
    r"   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
]
# é¬¼å¤ªéƒã®ä»²é–“ãŸã¡ï¼ˆãƒ‡ãƒ¢ç”»åƒé¢¨ã®ãƒŸãƒ‹ã‚­ãƒ£ãƒ©ï¼‰
KITARO_GANG = r" (ãƒ»Ï‰ãƒ») (ãƒ»âˆ€ãƒ») (o^-')b (  ^Ï‰^)"

# ã‚«ãƒ¢ãƒ¡ï¼ˆéšä¼´ã™ã‚‹éš å²ã®å‹ï¼‰
GULL_FRAMES = [
    r" \ / ",
    r" - - ",
    r" / \ "
]

# éš å²ã®å³¶ã€…ï¼ˆé æ™¯ï¼‰
ISLANDS = [
    r"      _    _          _        ",
    r"    _/ \__/ \_      _/ \_      ",
    r"  _/          \_  _/     \_    "
]

SMOKE_PATTERNS = [
    r"   (  )  ",
    r"  (    ) ",
    r" (      )",
    r"(        )"
]

def clear_screen():
    print("\033[2J\033[H", end="")

def get_terminal_size():
    try:
        columns, rows = shutil.get_terminal_size()
    except:
        columns, rows = 80, 24
    return columns, rows

def animate():
    cols, rows = get_terminal_size()
    f_width = len(FERRY_SHIRASHIMA[0])
    f_height = len(FERRY_SHIRASHIMA)
    
    smoke_list = []
    gulls = [[random.randint(20, 40), random.randint(2, 6), random.randint(0, 2)] for _ in range(3)]
    
    # èˆªè·¯é–‹å§‹
    for x in range(cols + 30, -f_width - 30, -1):
        clear_screen()
        
        # --- é æ™¯: éš å²ã®å³¶ã€… ---
        island_y = rows // 2 - 12
        for i, line in enumerate(ISLANDS):
            island_pos = (cols // 3) + (x // 10) # ã‚†ã£ãã‚Šå‹•ã
            if 0 < island_pos < cols:
                print(f"\033[{island_y + i};{island_pos}H\033[32m{line}\033[0m")

        # --- ç’°å¢ƒ: ç…™ ---
        if x % 4 == 0:
            smoke_list.append([x + 65, rows // 2 - 9, 0])
        new_smoke = []
        for s in smoke_list:
            sx, sy, sf = s
            if sf < len(SMOKE_PATTERNS) and 0 < sx < cols:
                print(f"\033[{sy};{sx}H\033[37m{SMOKE_PATTERNS[sf]}\033[0m")
                new_smoke.append([sx + 1, sy - 1, sf + 1])
        smoke_list = new_smoke

        # --- éšä¼´è€…: ã‚«ãƒ¢ãƒ¡ ---
        for g in gulls:
            gx_off, gy, gf = g
            gx = x + gx_off
            if 0 < gx < cols:
                print(f"\033[{gy};{gx}H\033[1m{GULL_FRAMES[gf]}\033[0m")
            g[2] = (gf + 1) % 3

        # --- æ°´é¢: æ—¥æœ¬æµ·ã®æ³¢ ---
        y_wave = rows // 2 + 6
        print(f"\033[{y_wave};1H\033[34m" + "~" * cols + "\033[0m")
        wave_dyn = "  _.-'  " * (cols // 8 + 1)
        print(f"\033[{y_wave + 1};1H\033[36m" + wave_dyn[x % 8 : x % 8 + cols] + "\033[0m")

        # --- ä¸»å½¹: ãƒ•ã‚§ãƒªãƒ¼ã—ã‚‰ã—ã¾ ---
        y_ship = rows // 2 - f_height // 2
        bob = 1 if (x // 5) % 4 < 2 else 0
        
        for i, line in enumerate(FERRY_SHIRASHIMA):
            y_pos = y_ship + i + bob
            if 0 < y_pos < rows:
                if 0 <= x < cols - f_width:
                    # å½©è‰²ï¼ˆã—ã‚‰ã—ã¾ã®èµ¤ã¨é’ã®ãƒ©ã‚¤ãƒ³ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
                    colored = line.replace("OKI", "\033[1;31mOKI\033[0m")
                    colored = colored.replace("é¬¼å¤ªéƒãƒ•ã‚§ãƒªãƒ¼", "\033[1;33mé¬¼å¤ªéƒãƒ•ã‚§ãƒªãƒ¼\033[0m")
                    colored = colored.replace("[ ]", "\033[34m[ ]\033[0m")
                    colored = colored.replace("(O)", "\033[1;37m(O)\033[0m") # æ•‘å‘½æµ®è¼ª
                    print(f"\033[{y_pos};{x}H{colored}", end="")
                elif x < 0:
                    print(f"\033[{y_pos};1H{line[abs(x):]}", end="")
                else:
                    print(f"\033[{y_pos};{x}H{line[:cols-x]}", end="")

        # --- éš å²ã‚¤ã‚ºãƒ  ---
        if x == cols // 2:
            msg = "ğŸš¢  éš å²è«¸å³¶ã¸ã‚ˆã†ã“ãï¼ - Welcome to the Oki Islands - ğŸš¢"
            print(f"\033[{rows // 2 - 12};{cols // 2 - len(msg)//2}H\033[1;32m{msg}\033[0m")

        sys.stdout.flush()
        time.sleep(0.03)

if __name__ == "__main__":
    print("\033[?25l", end="") # ã‚«ãƒ¼ã‚½ãƒ«éè¡¨ç¤º
    try:
        animate()
    except KeyboardInterrupt:
        pass
    finally:
        print("\033[?25h", end="") # ã‚«ãƒ¼ã‚½ãƒ«å†è¡¨ç¤º
        clear_screen()
